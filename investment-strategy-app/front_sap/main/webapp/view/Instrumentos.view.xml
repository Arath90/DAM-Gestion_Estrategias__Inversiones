<mvc:View controllerName="main.controller.Instrumentos"
    xmlns:mvc="sap.ui.core.mvc"
    xmlns="sap.f"
    xmlns:m="sap.m"
    xmlns:form="sap.ui.layout.form">
    <DynamicPage toggleHeaderOnTitleClick="false">
        <title>
            <DynamicPageTitle>
                <heading>
                    <m:Title text="Instrumentos" level="H2" />
                </heading>
                <actions>
                    <m:Button text="{= ${instrumentos>/showCreate} ? 'Cerrar formulario' : 'Agregar instrumento'}"
                        type="Emphasized"
                        press="onToggleCreate" />
                </actions>
            </DynamicPageTitle>
        </title>
        <content>
            <m:VBox class="sapUiLargeMargin" width="100%">
                <m:MessageStrip visible="{= !!${instrumentos>/status/text}}"
                    type="{instrumentos>/status/type}"
                    text="{instrumentos>/status/text}"
                    showIcon="true" />

                <m:Panel expandable="false"
                    visible="{instrumentos>/showCreate}"
                    headerText="Nuevo instrumento"
                    class="sapUiSmallMarginTop sapUiResponsiveMargin">
                    <m:VBox>
                        <form:SimpleForm editable="true" layout="ResponsiveGridLayout">
                            <form:content>
                                <m:Label text="Simbolo" />
                                <m:Input value="{instrumentos>/createData/symbol}" required="true" />

                                <m:Label text="Tipo" />
                                <m:Input value="{instrumentos>/createData/sec_type}" />

                                <m:Label text="Exchange" />
                                <m:Input value="{instrumentos>/createData/exchange}" />

                                <m:Label text="Moneda" />
                                <m:Input value="{instrumentos>/createData/currency}" />

                                <m:Label text="Multiplicador" />
                                <m:Input value="{instrumentos>/createData/multiplier}" />

                                <m:Label text="Clase" />
                                <m:Input value="{instrumentos>/createData/trading_class}" />

                                <m:Label text="CONID" />
                                <m:Input value="{instrumentos>/createData/ib_conid}" type="Number" />

                                <m:Label text="Subyacente CONID" />
                                <m:Input value="{instrumentos>/createData/underlying_conid}" type="Number" />

                                <m:Label text="Ultimo trade (ISO)" />
                                <m:Input value="{instrumentos>/createData/last_trade_date}" placeholder="YYYY-MM-DDTHH:mm" />

                                <m:Label text="Creado en origen (ISO)" />
                                <m:Input value="{instrumentos>/createData/created_at}" placeholder="YYYY-MM-DDTHH:mm" />
                            </form:content>
                        </form:SimpleForm>
                        <m:HBox class="sapUiSmallMarginTop" alignItems="Center" justifyContent="End">
                            <m:Button text="Limpiar" type="Transparent" press="onResetCreate" />
                            <m:Button text="{= ${instrumentos>/createBusy} ? 'Guardando...' : 'Guardar'}"
                                type="Emphasized"
                                enabled="{= !${instrumentos>/createBusy}}"
                                press="onCreateInstrument" />
                        </m:HBox>
                    </m:VBox>
                </m:Panel>

                <m:List id="instrumentList"
                    class="sapUiSmallMarginTop"
                    growing="false"
                    inset="false"
                    busy="{instrumentos>/listBusy}"
                    noDataText="{= ${instrumentos>/listBusy} ? 'Cargando instrumentos...' : 'Sin instrumentos disponibles'}"
                    items="{instrumentos>/items}">
                    <m:CustomListItem>
                        <m:Panel expandable="true"
                            expanded="{instrumentos>expanded}"
                            expand="onPanelExpand"
                            backgroundDesign="Transparent"
                            class="instrument-panel">
                            <m:headerToolbar>
                                <m:Toolbar>
                                    <m:Title level="H3" text="{instrumentos>symbol}" />
                                    <m:ToolbarSpacer />
                                    <m:Text text="{= (${instrumentos>sec_type} || 'N/D') + ' - ' + (${instrumentos>exchange} || '-') + ' - ' + (${instrumentos>currency} || '-')}" />
                                    <m:ToolbarSpacer />
                                    <m:Button icon="sap-icon://delete"
                                        tooltip="Eliminar"
                                        type="Transparent"
                                        press="onDeleteInstrument" />
                                </m:Toolbar>
                            </m:headerToolbar>
                            <m:content>
                                <m:VBox class="sapUiSmallMargin">
                                    <form:SimpleForm editable="false" layout="ResponsiveGridLayout">
                                        <form:content>
                                            <m:Label text="ID" />
                                            <m:Text text="{instrumentos>ID}" />

                                            <m:Label text="Multiplicador" />
                                            <m:Text text="{instrumentos>multiplier}" />

                                            <m:Label text="Clase" />
                                            <m:Text text="{instrumentos>trading_class}" />

                                            <m:Label text="CONID" />
                                            <m:Text text="{instrumentos>ib_conid}" />

                                            <m:Label text="Subyacente" />
                                            <m:Text text="{instrumentos>underlying_conid}" />

                                            <m:Label text="Ultimo trade" />
                                            <m:Text text="{instrumentos>last_trade_date}" />
                                        </form:content>
                                    </form:SimpleForm>

                                    <form:SimpleForm editable="true" layout="ResponsiveGridLayout" class="sapUiSmallMarginTop">
                                        <form:content>
                                            <m:Label text="Simbolo" />
                                            <m:Input value="{instrumentos>editData/symbol}" />

                                            <m:Label text="Tipo" />
                                            <m:Input value="{instrumentos>editData/sec_type}" />

                                            <m:Label text="Exchange" />
                                            <m:Input value="{instrumentos>editData/exchange}" />

                                            <m:Label text="Moneda" />
                                            <m:Input value="{instrumentos>editData/currency}" />

                                            <m:Label text="Multiplicador" />
                                            <m:Input value="{instrumentos>editData/multiplier}" />

                                            <m:Label text="Clase" />
                                            <m:Input value="{instrumentos>editData/trading_class}" />

                                            <m:Label text="CONID" />
                                            <m:Input value="{instrumentos>editData/ib_conid}" type="Number" />

                                            <m:Label text="Subyacente CONID" />
                                            <m:Input value="{instrumentos>editData/underlying_conid}" type="Number" />

                                            <m:Label text="Ultimo trade (ISO)" />
                                            <m:Input value="{instrumentos>editData/last_trade_date}" placeholder="YYYY-MM-DDTHH:mm" />

                                            <m:Label text="Creado en origen (ISO)" />
                                            <m:Input value="{instrumentos>editData/created_at}" placeholder="YYYY-MM-DDTHH:mm" />
                                        </form:content>
                                    </form:SimpleForm>
                                    <m:HBox justifyContent="End" class="sapUiTinyMarginTop">
                                        <m:Button text="{= ${instrumentos>busy} ? 'Guardando...' : 'Actualizar'}"
                                            type="Emphasized"
                                            press="onUpdateInstrument"
                                            enabled="{= !${instrumentos>busy}}" />
                                    </m:HBox>
                                </m:VBox>
                            </m:content>
                        </m:Panel>
                    </m:CustomListItem>
                </m:List>
            </m:VBox>
        </content>
    </DynamicPage>
</mvc:View>

