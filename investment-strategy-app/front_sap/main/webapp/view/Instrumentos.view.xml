<mvc:View controllerName="main.controller.Instrumentos"
    xmlns:mvc="sap.ui.core.mvc"
    xmlns="sap.f"
    xmlns:m="sap.m"
    xmlns:form="sap.ui.layout.form">
    <DynamicPage id="instrumentDynamicPage" toggleHeaderOnTitleClick="false" class="appDynamicPage">
        <title>
            <DynamicPageTitle id="instrumentDynamicPageTitle">
                <heading>
                    <m:Title id="instrumentPageHeadingTitle" text="Instrumentos" level="H2" />
                </heading>
                <actions>
                    <m:Button id="instrumentGlossaryButton"
                        icon="sap-icon://hint"
                        type="Transparent"
                        tooltip="Ver glosario de campos"
                        press="onOpenGlossary" />
                    <m:Button id="instrumentToggleCreateButton"
                        text="{= ${instrumentos>/showCreate} ? 'Cerrar formulario' : 'Agregar instrumento'}"
                        type="Emphasized"
                        press="onToggleCreate" />
                </actions>
            </DynamicPageTitle>
        </title>
        <content>
            <m:VBox id="instrumentMainVBox" class="appContentContainer sapUiResponsiveMargin" width="100%">
                <m:MessageStrip id="instrumentStatusMessageStrip"
                    visible="{= !!${instrumentos>/status/text}}"
                    type="{instrumentos>/status/type}"
                    text="{instrumentos>/status/text}"
                    showIcon="true" />

                <m:Panel id="instrumentCreatePanel"
                    expandable="false"
                    visible="{instrumentos>/showCreate}"
                    headerText="Nuevo instrumento"
                    class="sapUiSmallMarginTop sapUiResponsiveMargin">
                    <m:VBox id="instrumentContainerForm">
                        <form:SimpleForm id="instrumentCreateForm" editable="true" layout="ResponsiveGridLayout">
                            <form:content>
                                <m:Label text="Simbolo" id="instrumentCreateLabel" tooltip="Ticker o symbol tal como se negocia el instrumento." />
                                <m:Input value="{instrumentos>/createData/symbol}" id="instrumentCreateField" required="true" />

                                <m:Label text="Tipo" tooltip="Tipo de contrato (STK, FUT, OPT, CASH, etc.)." />
                                <m:Input value="{instrumentos>/createData/sec_type}" />

                                <m:Label text="Exchange" tooltip="Bolsa o mercado donde cotiza el instrumento." />
                                <m:Input value="{instrumentos>/createData/exchange}" />

                                <m:Label text="Moneda" tooltip="Divisa de cotizacion (USD, MXN, EUR, etc.)." />
                                <m:Input value="{instrumentos>/createData/currency}" />

                                <m:Label text="Multiplicador" tooltip="Factor multiplicador aplicado al contrato." />
                                <m:Input value="{instrumentos>/createData/multiplier}" />

                                <m:Label text="Clase" tooltip="Trading class o familia del contrato segun el broker." />
                                <m:Input value="{instrumentos>/createData/trading_class}" />

                                <m:Label text="CONID" tooltip="Identificador unico del instrumento en el proveedor (CONID)." />
                                <m:Input value="{instrumentos>/createData/ib_conid}" type="Number" />

                                <m:Label text="Subyacente CONID" tooltip="CONID del subyacente asociado, si aplica." />
                                <m:Input value="{instrumentos>/createData/underlying_conid}" type="Number" />

                                <m:Label text="Ultimo trade (ISO)" tooltip="Fecha del ultimo trade registrada en formato ISO 8601." />
                                <m:Input value="{instrumentos>/createData/last_trade_date}" placeholder="YYYY-MM-DDTHH:mm" />

                                <m:Label text="Creado en origen (ISO)" tooltip="Fecha de creacion en el sistema de origen (ISO 8601)." />
                                <m:Input value="{instrumentos>/createData/created_at}" placeholder="YYYY-MM-DDTHH:mm" />
                            </form:content>
                        </form:SimpleForm>
                        <m:HBox id="instrumentCreateActionsBox" class="sapUiSmallMarginTop" alignItems="Center" justifyContent="End">
                            <m:Button id="instrumentClearCreateButton" text="Limpiar" type="Transparent" press="onResetCreate" />
                            <m:Button id="instrumentSaveCreateButton"
                                text="{= ${instrumentos>/createBusy} ? 'Guardando...' : 'Guardar'}"
                                type="Emphasized"
                                enabled="{= !${instrumentos>/createBusy}}"
                                press="onCreateInstrument" />
                        </m:HBox>
                    </m:VBox>
                </m:Panel>

                <m:List id="instrumentList"
                    class="sapUiSmallMarginTop"
                    growing="false"
                    inset="false"
                    busy="{instrumentos>/listBusy}"
                    noDataText="{= ${instrumentos>/listBusy} ? 'Cargando instrumentos...' : 'Sin instrumentos disponibles'}"
                    items="{instrumentos>/items}">
                    <m:CustomListItem id="instrumentListItemTemplate">
                        <m:Panel id="instrumentItemPanel"
                            expandable="true"
                            expanded="{instrumentos>expanded}"
                            expand="onPanelExpand"
                            backgroundDesign="Transparent"
                            class="instrument-panel">
                            <m:headerToolbar>
                                <m:Toolbar id="instrumentItemToolbar">
                                    <m:Title id="instrumentItemTitle" level="H3" text="{instrumentos>symbol}" />
                                    <m:ToolbarSpacer />
                                    <m:Text id="instrumentItemSummaryText" text="{= (${instrumentos>sec_type} || 'N/D') + ' - ' + (${instrumentos>exchange} || '-') + ' - ' + (${instrumentos>currency} || '-')}" />
                                    <m:ToolbarSpacer />
                                    <m:Button id="instrumentDeleteButton"
                                        icon="sap-icon://delete"
                                        tooltip="Eliminar"
                                        type="Transparent"
                                        press="onDeleteInstrument" />
                                </m:Toolbar>
                            </m:headerToolbar>
                            <m:content>
                                <m:VBox id="instrumentItemContentBox" class="sapUiSmallMargin">
                                    <form:SimpleForm id="instrumentItemDisplayForm" editable="false" layout="ResponsiveGridLayout">
                                        <form:content>
                                            <m:Label text="ID" tooltip="Identificador unico dentro del catalogo." />
                                            <m:Text text="{instrumentos>ID}" />

                                            <m:Label text="Multiplicador" tooltip="Factor multiplicador aplicado al contrato." />
                                            <m:Text text="{instrumentos>multiplier}" />

                                            <m:Label text="Clase" tooltip="Trading class o familia del contrato segun el broker." />
                                            <m:Text text="{instrumentos>trading_class}" />

                                            <m:Label text="CONID" tooltip="Identificador unico del instrumento en el proveedor (CONID)." />
                                            <m:Text text="{instrumentos>ib_conid}" />

                                            <m:Label text="Subyacente" tooltip="CONID del subyacente asociado, si aplica." />
                                            <m:Text text="{instrumentos>underlying_conid}" />

                                            <m:Label text="Ultimo trade" tooltip="Fecha del ultimo trade registrada en formato ISO 8601." />
                                            <m:Text text="{instrumentos>last_trade_date}" />
                                        </form:content>
                                    </form:SimpleForm>

                                    <form:SimpleForm id="instrumentItemEditForm" editable="true" layout="ResponsiveGridLayout" class="sapUiSmallMarginTop">
                                        <form:content>
                                            <m:Label text="Simbolo" tooltip="Ticker o symbol tal como se negocia el instrumento." />
                                            <m:Input value="{instrumentos>editData/symbol}" />

                                            <m:Label text="Tipo" tooltip="Tipo de contrato (STK, FUT, OPT, CASH, etc.)." />
                                            <m:Input value="{instrumentos>editData/sec_type}" />

                                            <m:Label text="Exchange" tooltip="Bolsa o mercado donde cotiza el instrumento." />
                                            <m:Input value="{instrumentos>editData/exchange}" />

                                            <m:Label text="Moneda" tooltip="Divisa de cotizacion (USD, MXN, EUR, etc.)." />
                                            <m:Input value="{instrumentos>editData/currency}" />

                                            <m:Label text="Multiplicador" tooltip="Factor multiplicador aplicado al contrato." />
                                            <m:Input value="{instrumentos>editData/multiplier}" />

                                            <m:Label text="Clase" tooltip="Trading class o familia del contrato segun el broker." />
                                            <m:Input value="{instrumentos>editData/trading_class}" />

                                            <m:Label text="CONID" tooltip="Identificador unico del instrumento en el proveedor (CONID)." />
                                            <m:Input value="{instrumentos>editData/ib_conid}" type="Number" />

                                            <m:Label text="Subyacente CONID" tooltip="CONID del subyacente asociado, si aplica." />
                                            <m:Input value="{instrumentos>editData/underlying_conid}" type="Number" />

                                            <m:Label text="Ultimo trade (ISO)" tooltip="Fecha del ultimo trade registrada en formato ISO 8601." />
                                            <m:Input value="{instrumentos>editData/last_trade_date}" placeholder="YYYY-MM-DDTHH:mm" />

                                            <m:Label text="Creado en origen (ISO)" tooltip="Fecha de creacion en el sistema de origen (ISO 8601)." />
                                            <m:Input value="{instrumentos>editData/created_at}" placeholder="YYYY-MM-DDTHH:mm" />
                                        </form:content>
                                    </form:SimpleForm>
                                    <m:HBox id="instrumentItemEditActions" justifyContent="End" class="sapUiTinyMarginTop">
                                        <m:Button id="instrumentUpdateButton"
                                            text="{= ${instrumentos>busy} ? 'Guardando...' : 'Actualizar'}"
                                            type="Emphasized"
                                            press="onUpdateInstrument"
                                            enabled="{= !${instrumentos>busy}}" />
                                    </m:HBox>
                                </m:VBox>
                            </m:content>
                        </m:Panel>
                    </m:CustomListItem>
                </m:List>
            </m:VBox>
        </content>
    </DynamicPage>
</mvc:View>
